let homepage_screen = 1;
let registration_screen = 2;
let game_screan_catch = 3;
let game_screan_hide = 4;

let current_screen = 1;

document.addEventListener('backbutton', onBackKeyDown, false);

function onBackKeyDown() {
    if (current_screen != homepage_screen){
        if (current_screen == game_screan_catch || current_screen == game_screan_hide){
            socket.emit('playerQuit', getIndex());
        }
        current_screen = homepage_screen;
        loadScreen();
    }
    // if (current_page != 'gameroom-page'){
    //     document.getElementById(current_page).style.visibility = "hidden";
    //     document.getElementById(previous_page).style.visibility = "visible";
    // } else {
    //     navigator.notification.confirm('Are you sure you want to exit the game?', onConfirm, 'Notice', ['Exit', 'Cancel']);
    // }
}

// Go to registration page
function startButton(){
    current_screen = registration_screen;
    loadScreen();
}

function submitButton(){
    var result = getRegistrationInfo();
    if (result){
        if (this_player['toChase']){
            current_screen = game_screan_catch; 
        } else {
            current_screen = game_screan_hide;
        }
        loadScreen();
    }
}

function exitButton(){
    current_screen = homepage_screen;
    // on click: delete from players (server + client)

    document.getElementById('backpack').style.display = "none";
    loadScreen();
}

function loadScreen(){
    if (current_screen == homepage_screen){
        document.getElementById('homepage').style.visibility = "visible";
        document.getElementById('registration-page').style.visibility = "hidden";
        document.getElementById('gameroom-page').style.visibility = "hidden";
    } else if(current_screen == registration_screen){
        document.getElementById('homepage').style.visibility = "hidden";
        document.getElementById('registration-page').style.visibility = "visible";
        document.getElementById('gameroom-page').style.visibility = "hidden";
    } else if(current_screen == game_screan_catch){
        document.getElementById('homepage').style.visibility = "hidden";
        document.getElementById('registration-page').style.visibility = "hidden";
        document.getElementById('gameroom-page').style.visibility = "visible";
        document.getElementById('catch-button').style.display = "flex";
        document.getElementById('status-check').style.display = "none";
        document.getElementById('level').innerHTML = "Level " + this_player['level'];
    } else if(current_screen == game_screan_hide){
        document.getElementById('homepage').style.visibility = "hidden";
        document.getElementById('registration-page').style.visibility = "hidden";
        document.getElementById('gameroom-page').style.visibility = "visible";
        document.getElementById('catch-button').style.display = "none";
        document.getElementById('status-check').style.display = "flex";
        document.getElementById('level').innerHTML = "Level " + this_player['level'];
        const time = document.createElement("div");
        time.id = "time";
        time.classList.add('time');
        document.getElementById('bar').appendChild(time);
        timerSubscription = timer.subscribe(
            (sec) => {
                var newWidth = 100 * (seconds - sec - 1) / seconds;
                document.getElementById('time').style.width = newWidth + "%";
                if (sec == seconds-1){
                    alert('level up!');
                    upgradeToLevel2(getIndex());
                    socket.emit('updatePlayer', players[getIndex()]);
                }
            },
        );
    }
}